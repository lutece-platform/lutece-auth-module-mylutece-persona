<center>
    <br/>
    <h2>#i18n{module.mylutece.persona.login_form.pageTitle}</h2>
    <br/>
    <br/>

    <#if user_registered >
        <button id="sign-out"><img src="https://browserid.org/i/sign_out_blue.png" alt="Sign out"/> </button>
    <#else>
        <button id="sign-in"><img src="https://browserid.org/i/sign_in_blue.png" alt="Sign in"/> </button>
    </#if>
</center>


<script src="https://login.persona.org/include.js"></script>

<script>

    $("#sign-in").click(function(e) {
        e.preventDefault();
        navigator.id.request();
    });

    $("#sign-out").click(function(e) {
        e.preventDefault();
        navigator.id.logout();
    });

    function verifyAssertion(assertion) {
        $.post("servlet/plugins/mylutece/modules/persona/auth/login", {assertion: assertion}, function onSuccess(resp) {
            // maybe you return a json response including the email
            updateUser(resp.email);
            document.location.reload();
        });
    }
    ;

    function logout() {
        $.post("servlet/plugins/mylutece/modules/persona/auth/logout", {}, function onSuccess(resp) {
            document.location.reload();
        });
    }
    ;

    navigator.id.watch({
        onlogin: function(assertion) {
            verifyAssertion(assertion);
        },
        onlogout: function() {
            logout();
        },
        loggedInUser: undefined
    });


</script>

